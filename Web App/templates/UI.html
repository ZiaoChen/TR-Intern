<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Marco Polo</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.4/css/selectize.default.css">
    <link rel="stylesheet" href="{{url_for('static', filename='Squared Corners.css')}}">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.4/js/standalone/selectize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.js"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        $(document).ready(function(){
            // $('.panel.panel-default').hide()
            $('#company-input-group').hide()
            $('#edit').click(function(){
                $(".table .toggleDisplay").toggleClass("in");
                var button = document.getElementById('edit')
                var node_content = button.childNodes[0].childNodes[0].nodeValue
                if (node_content != 'edit'){
                    button.childNodes[0].childNodes[0].nodeValue = 'edit'
                    $('#company-input-group').hide()
                    updateCards()
                }
                else{
                    button.childNodes[0].childNodes[0].nodeValue = 'save updates'
                    $('#company-input-group').show()
                }
            });
        });
    </script>
    <script>
        function updateCards(){
            $('.panel.panel-default').hide()
            $('input[name="company-row"]:checked').each(function(){
                $('.panel.panel-default[name=' + this.value + ']').show()
            })

        }
        function addRow(){
            var company_name = ($('#company-input').val())
            var company_info_list = {{company_info_list|safe}}
            document.getElementById('company-input').value = ""

            for (var i in company_info_list){
                if (company_name == company_info_list[i].Name_EN + " (" + company_info_list[i].RIC + ")"){
                    var table = document.getElementById('portfolio-list')
                    var tr = table.insertRow()
                    var checkbox = tr.insertCell(0)
                    var name = tr.insertCell(1)
                    var ric = tr.insertCell(2)
                    var remove_button = tr.insertCell(3)
                    tr.id = company_info_list[i].PermID
                    tr.className = 'success'
                    checkbox.className = "toggleDisplay"
                    remove_button.className = "toggleDisplay in"
                    remove_button.innerHTML = "<a href='#' onclick='removeRow(this);'><span class='glyphicon glyphicon-remove'></span></a>"
                    checkbox.innerHTML = "<input name='company-row' type='checkbox' checked = 'checked' onclick='updateCards()' value="+ tr.id+ ">"
                    name.innerHTML = company_info_list[i].Name_EN
                    ric.innerHTML = company_info_list[i].RIC
                }
            }
        }

        function removeRow(node){
            var i = node.parentNode.parentNode.rowIndex
            document.getElementById('portfolio-list').deleteRow(i)
        }

        function changeButton(button){
            var button_content = button.childNodes[0].nodeValue
            var id = button.id

            var toggle_element = document.getElementById('content-'+id)
            var snippet = document.getElementById('snippet-'+id)
            if (button_content != 'collapse'){
                toggle_element.style.maxHeight = screen.height / 3 + 'px'
                button.childNodes[0].nodeValue = 'collapse'
                toggle_element.style.overflowY = 'scroll'
                snippet.classList.remove('fadeout')

            }
            else{
                button.childNodes[0].nodeValue = 'click to expand'
                toggle_element.style.overflowY = 'hidden'
                snippet.className = 'fadeout'
            }

        }


    </script>
    <style>

        td {
            border-bottom: 10px solid white!important;
        }
        .table > tbody > tr.success > td{
            background-color: #999 !important;
            color: #FFFFFF !important;
        }
        a{
            color: inherit !important;
            text-decoration: none;
        }
        a:hover{
            text-decoration: none !important;
        }

        .nav-pills > .active > a,
        .nav-pills > .active > a:hover,.nav-pills > li > a:hover{
            text-decoration: none;
            border-radius:0px;
            border-bottom-width: 3px;
            border-bottom-style: solid;
            border-bottom-color: #005DA2;
            color: #005DA2 !important;
            background-color: transparent !important;
        }
          .affix {
              top: 20px;
              z-index: 9999 !important;
          }
          .fadeout {
              background: -webkit-linear-gradient(#D0D0D0, #000000, #D0D0D0);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              margin:0;
          }

        .content-hover:hover .button-hover{
            opacity:1 !important;
        }

        .button-hover{
            opacity: 0 !important;
            transition: opacity .35s ease !important;
        }

        .toggleDisplay{
            display:none;
        }

        .toggleDisplay.in{
            display:table-cell;
        }

        .right-inner-addon {
            position: relative;
        }
        .right-inner-addon input {
            padding-right: 30px;
        }
        .right-inner-addon a {
            position: absolute;
            right: 0px;
            padding: 10px 12px;
            pointer-events: none;
        }
    </style>
</head>
<body style=" background:#f9fafa !important;">
    <nav class="navbar" style="background-color:#FF8000;border-color:#FF8000">
      <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#" style="color:#FFFFFF !important;">Marco Polo</a>
        </div>
          <a class="navbar-brand navbar-right">
              <img src="{{url_for('static', filename='logo.png')}}" height="25px" width="150px"/>
          </a>

      </div>
    </nav>

    <div class="container-fluid">
        <br>
        <div class="row">
            <div class="col-sm-1"></div>
            <div class="col-sm-3">
                <b><font size="6">Portfolio</font></b>
                <a id ="edit" href="#" style="position: absolute;right:16px !important; bottom:8px;!important;color: #005DA2 !important;"><font size="4">edit</font></a>
            </div>
            <div class="col-sm-7">
                <ul class="nav nav-pills">
                    <li class="active"><a href="#">New Updates</a></li>
                    <li><a href="#">This Week</a></li>
                    <li><a href="#">All</a></li>
                </ul>
            </div>
            <div class="col-sm-1"></div>
        </div>
        <div class="row">
            <div class="col-sm-1"></div>
        <nav class="col-sm-3">
            <br>
            <div id="company-input-group">
                <div class="input-group">
                    <input id='company-input' class="form-control" type="text" data-provide="typeahead" data-source='{{ company_list|safe }}' onkeydown="if (event.keyCode == 13) addRow();" >
                    <span class="input-group-addon"><a href="#" onclick="addRow();"><span class="glyphicon glyphicon-ok"></span></a></span>
                </div>
                <br>
            </div>
            <table class="table" id="portfolio-list">
            </table>
        </nav>
        <div class="col-sm-7">
             <br>
             <div class="panel-group" id="articles">
                 {% for card in cards %}
                 <div class="panel panel-default" id="{{card.Article_ID}}" name = {{card.PermID}} style="border:none;box-shadow:none;">
                     {% if card.Relevance < 30 %}
                    <div class="panel-heading" style="background-color: #AFAFAF;color:#FFFFFF;">
                        <div class="row">
                            <div class="col-sm-2">
                                <font size="2">{{card.Relevance}}% Relevant</font>
                            </div>
                            <div class="col-sm-6">
                                <a href="https://permid.org/1-{{card.PermID}}">
                                    <font size="4">{{card.Name_EN}} | {{card.Name}}</font>
                                </a>
                            </div>

                            <div class="col-sm-2" align="right">
                                <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
                                <a href="file:///C:\Users\uc238618\Desktop\Web%20App\Data\Articles\articles_920_chinese_articles\20160701-000304000-nACN30906a-1-2.html">
                                    <font size="2">{{ card.Source }}</font>
                                </a>
                            </div>
                            <div class="col-sm-2" align="right">
                                <font size="1">{{ card.Time }}</font>
                            </div>
                        </div>

                    </div>
                     {% elif card.Relevance < 60 %}
                     <div class="panel-heading" style="background-color: #FF8000;color:#FFFFFF;">
                        <div class="row">
                            <div class="col-sm-2">
                                <font size="2">{{card.Relevance}}% Relevant</font>
                            </div>
                            <div class="col-sm-6">
                                <a href="https://permid.org/1-{{card.PermID}}">
                                    <font size="4">{{card.Name_EN}} | {{card.Name}}</font>
                                </a>
                            </div>

                            <div class="col-sm-2" align="right">
                                <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
                                <a href="file:///C:\Users\uc238618\Desktop\Web%20App\Data\Articles\articles_920_chinese_articles\20160701-000304000-nACN30906a-1-2.html">
                                    <font size="2">{{ card.Source }}</font>
                                </a>
                            </div>
                            <div class="col-sm-2" align="right">
                                <font size="1">{{ card.Time }}</font>
                            </div>
                        </div>

                    </div>
                     {% else %}
                     <div class="panel-heading" style="background-color: #A00000;color:#FFFFFF;">
                        <div class="row">
                            <div class="col-sm-2">
                                <font size="2">{{card.Relevance}}% Relevant</font>
                            </div>
                            <div class="col-sm-6">
                                <a href="https://permid.org/1-{{card.PermID}}">
                                    <font size="4">{{card.Name_EN}} | {{card.Name}}</font>
                                </a>
                            </div>

                            <div class="col-sm-2" align="right">
                                <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
                                <a href="file:///C:\Users\uc238618\Desktop\Web%20App\Data\Articles\articles_920_chinese_articles\20160701-000304000-nACN30906a-1-2.html">
                                    <font size="2">{{ card.Source }}</font>
                                </a>
                            </div>
                            <div class="col-sm-2" align="right">
                                <font size="1">{{ card.Time }}</font>
                            </div>
                        </div>

                    </div>
                     {% endif %}
                    <div class="panel-body content-hover">
                        <div class="row">
                            <div class="col-sm-12" id="content-{{card.Article_ID + card.PermID}}" style="overflow-y: hidden;">
                                <p class="collapse", id="first-half-{{card.Article_ID + card.PermID}}">
                                    {{card.First_Half|safe}}
                                </p>
                                    <p id="snippet-{{card.Article_ID + card.PermID}}" class="fadeout">
                                        {{card.Middle|safe}}
                                    </p>
                                <p class="collapse" style="margin:0" id="second-half-{{card.Article_ID + card.PermID}}">
                                    {{card.Second_Half|safe}}
                                </p>
                                <p align="center" style="margin:0">
                                    <a style="color:#FFFFFF !important; border-radius: 10px !important; font-weight: normal !important;" id="{{card.Article_ID + card.PermID}}" class='label label-default button-hover' data-toggle="collapse" data-target="#first-half-{{card.Article_ID + card.PermID}},#second-half-{{card.Article_ID + card.PermID}}" href="" onclick="changeButton(this);return false;">click to expand</a>
                                </p>
                            </div>
                        </div>
                    </div>
                     <br>
                </div>
                {% endfor %}
            </div>

        </div>
            <div class="col-sm-1"></div>
        </div>
    </div>

    <footer class="footer">
        <div class="container" align="center">
            <span class="text-muted">Thomson Reuters Lab (c) 2017</span>
        </div>
    </footer>
    <br>
</body>
</html>